generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions", "views"]
}

generator erd {
  provider                  = "prisma-erd-generator"
  includeRelationFromFields = "true"
  theme                     = "neutral"
}

datasource db {
  provider          = "postgresql"
  url               = env("POSTGRES_PRISMA_URL")
  directUrl         = env("POSTGRES_URL_NON_POOLING")
  shadowDatabaseUrl = env("POSTGRES_URL_NON_POOLING")
  extensions        = [postgis]
}

model study {
  id                   Int                @id @default(autoincrement())
  name                 String
  slug                 String             @unique
  description          String
  details              String?
  image_src            String?
  centroid_coordinates Float[]            @default([0, 0])
  zoom_level_start     Int                @default(14)
  bbox                 Float[]            @default([0, 0, 0, 0])
  created_at           DateTime           @default(now())
  updated_at           DateTime           @updatedAt
  study_scale          study_scale
  study_themes         theme[]
  study_geometries     geometries[]
  metrics              metrics[]
  metrics_metadata     metrics_metadata[]
}

model theme {
  name       String
  slug       String
  study_id   Int
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
  scenarios  scenario[]
  study      study?     @relation(fields: [studyId], references: [id])
  studyId    Int?

  @@id([study_id, name])
}

model scenario {
  id               Int                @id @default(autoincrement())
  name             String
  description      String?
  methodology      String?
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  slug             String             @unique
  scenario_subtype scenario_subtype[]
  theme            theme?             @relation(fields: [themeStudy_id, themeName], references: [study_id, name])
  themeStudy_id    Int?
  themeName        String?
}

model scenario_subtype {
  id               Int                @id @default(autoincrement())
  name             String
  slug             String             @unique
  description      String?
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  scenario_id      Int
  metrics_metadata metrics_metadata[]
  scenario         scenario           @relation(fields: [scenario_id], references: [id])
}

model geometries {
  name       String                  @id @unique
  study_id   Int
  created_at DateTime                @default(now())
  updated_at DateTime                @updatedAt
  geom       Unsupported("geometry")
  study      study                   @relation(fields: [study_id], references: [id])
  metrics    metrics[]

  @@index([study_id])
}

model metrics_metadata {
  study_id            Int
  field_name          String
  description         String
  units               String
  usage_type          String?
  energy_source       String?
  map_display         Boolean           @default(false)
  scenario_id         Int?
  scenario_subtype_id Int?
  scenario_subtype    scenario_subtype? @relation(fields: [scenario_subtype_id], references: [id])
  study               study             @relation(fields: [study_id], references: [id])

  @@id([study_id, field_name])
  @@index([map_display])
}

model metrics {
  study_id     Int
  geometry_key String
  data         Json
  geometry     geometries @relation(fields: [geometry_key], references: [name])
  study        study      @relation(fields: [study_id], references: [id])

  @@id([study_id, geometry_key])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

/// The underlying view does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
view vw_map_fields {
  id                  BigInt?
  study_id            Int?
  scenario_id         Int?
  scenario_subtype_id Int?
  field_name          String?

  @@ignore
}

/// The underlying view does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
view geography_columns {
  f_table_catalog    Unsupported("name")?
  f_table_schema     Unsupported("name")?
  f_table_name       Unsupported("name")?
  f_geography_column Unsupported("name")?
  coord_dimension    Int?
  srid               Int?
  type               String?

  @@ignore
}

/// The underlying view does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
view geometry_columns {
  f_table_catalog   String?              @db.VarChar(256)
  f_table_schema    Unsupported("name")?
  f_table_name      Unsupported("name")?
  f_geometry_column Unsupported("name")?
  coord_dimension   Int?
  srid              Int?
  type              String?              @db.VarChar(30)

  @@ignore
}

enum study_scale {
  Municipality
  Building
}
